CREATE TABLE "part" (
	"id" serial NOT NULL,
	"specification" character varying(400) NOT NULL,
	"unit_fk" int NOT NULL,
	"tag" int,
	"note" character varying(200),
	CONSTRAINT part_pk PRIMARY KEY ("id")
) WITH (
  OIDS=FALSE
);



CREATE TABLE "unit" (
	"id" serial NOT NULL,
	"name" character varying(4) NOT NULL UNIQUE,
	CONSTRAINT unit_pk PRIMARY KEY ("id")
) WITH (
  OIDS=FALSE
);



CREATE TABLE "user_profile" (
	"id" serial NOT NULL,
	"email" character varying(80) NOT NULL UNIQUE,
	"password" character varying(80) NOT NULL UNIQUE,
	"department_fk" int NOT NULL,
	"role" int NOT NULL UNIQUE,
	"entry" DATE NOT NULL,
	CONSTRAINT user_profile_pk PRIMARY KEY ("id")
) WITH (
  OIDS=FALSE
);



CREATE TABLE "department" (
	"id" serial NOT NULL,
	"name" character varying NOT NULL UNIQUE,
	CONSTRAINT department_pk PRIMARY KEY ("id")
) WITH (
  OIDS=FALSE
);



CREATE TABLE "tag" (
	"id" serial NOT NULL,
	"tag_name" character varying(20) NOT NULL UNIQUE,
	CONSTRAINT tag_pk PRIMARY KEY ("id")
) WITH (
  OIDS=FALSE
);



CREATE TABLE "transfer" (
	"id" serial NOT NULL,
	"part_fk" int NOT NULL,
	"new_department_fk" int NOT NULL,
	"prev_department_fk" int NOT NULL,
	"amount" DECIMAL NOT NULL,
	"date" DATE NOT NULL,
	"note" character varying(200),
	"status" character varying(10) NOT NULL,
	CONSTRAINT transfer_pk PRIMARY KEY ("id")
) WITH (
  OIDS=FALSE
);



CREATE TABLE "reserve" (
	"id" serial NOT NULL,
	"part_fk" int NOT NULL,
	"department_fk" int NOT NULL,
	"amount" DECIMAL NOT NULL,
	"date" DATE NOT NULL,
	"note" character varying(200),
	"status" character varying(10) NOT NULL,
	CONSTRAINT reserve_pk PRIMARY KEY ("id")
) WITH (
  OIDS=FALSE
);



CREATE TABLE "department_part" (
	"part_fk" int NOT NULL,
	"department_fk" int NOT NULL,
	"quantity" DECIMAL NOT NULL,
	"date_change" DATE NOT NULL,
	CONSTRAINT department_part_pk PRIMARY KEY ("part_fk","department_fk")
) WITH (
  OIDS=FALSE
);



CREATE TABLE "part_tag" (
	"part_fk" int NOT NULL,
	"tag_fk" int NOT NULL,
	CONSTRAINT part_tag_pk PRIMARY KEY ("part_fk","tag_fk")
) WITH (
  OIDS=FALSE
);



ALTER TABLE "part" ADD CONSTRAINT "part_fk0" FOREIGN KEY ("unit_fk") REFERENCES "unit"("id");


ALTER TABLE "user_profile" ADD CONSTRAINT "user_profile_fk0" FOREIGN KEY ("department_fk") REFERENCES "department"("id");



ALTER TABLE "transfer" ADD CONSTRAINT "transfer_fk0" FOREIGN KEY ("part_fk") REFERENCES "part"("id");
ALTER TABLE "transfer" ADD CONSTRAINT "transfer_fk1" FOREIGN KEY ("new_department_fk") REFERENCES "department"("id");
ALTER TABLE "transfer" ADD CONSTRAINT "transfer_fk2" FOREIGN KEY ("prev_department_fk") REFERENCES "department"("id");

ALTER TABLE "reserve" ADD CONSTRAINT "reserve_fk0" FOREIGN KEY ("part_fk") REFERENCES "part"("id");
ALTER TABLE "reserve" ADD CONSTRAINT "reserve_fk1" FOREIGN KEY ("department_fk") REFERENCES "department"("id");

ALTER TABLE "department_part" ADD CONSTRAINT "department_part_fk0" FOREIGN KEY ("part_fk") REFERENCES "part"("id");
ALTER TABLE "department_part" ADD CONSTRAINT "department_part_fk1" FOREIGN KEY ("department_fk") REFERENCES "department"("id");

ALTER TABLE "part_tag" ADD CONSTRAINT "part_tag_fk0" FOREIGN KEY ("part_fk") REFERENCES "part"("id");
ALTER TABLE "part_tag" ADD CONSTRAINT "part_tag_fk1" FOREIGN KEY ("tag_fk") REFERENCES "tag"("id");
